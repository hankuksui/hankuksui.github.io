class LxySelect{constructor(c,e){this.selectPlaceHolder="--请选择--",this.selectId="",this.searchPlaceHolder="输入过滤字符",this.width="120px",this.css={},this.selectEx=[],this.inDuration=200,this.outDuration=300;var t=this;t.setOption(c);var a=$("<span class='lxy-select-area closed' for='"+t.selectId+"'></span>"),s=$('<input readonly="readonly" placeHolder="'+t.selectPlaceHolder+'" id="'+t.selectId+'" class="lxy-select" />'),i=$('<div for="'+t.selectId+'" class="select-dropdown"></div>'),l=$('<input placeholder="'+t.searchPlaceHolder+'" class="search-box" />'),p=$('<div class="options"></div>');s.width(t.width),s.css(t.css),s.data("inDuration",this.inDuration),s.data("outDuration",this.outDuration),c.data&&c.data.forEach((e,t)=>{var a=$('<div class="dropdown-item" value="'+e.value+'"></div>'),s=$('<div class="item-prefix"></div>'),i=$('<div class="item-suffix">'+e.suffix+"</div>"),l=$('<div class="item-text">'+e.text+"</div>"),n=$('<div class="item-operation"></div>');if(s.append(e.prefix),c.operations)for(var o=0;o<c.operations.length;o++){var r=c.operations[o],d=$('<button class="operation-button operation-button-'+o+'">'+r.text+"</button>");r.listener&&d.data("listener",r.listener),r.class&&d.addClass(r.class),n.append(d)}a.attr("index",t),e.attr&&e.attr.forEach(e=>{a.attr(e.key,e.value)}),a.append([e.prefix?s:null,l,e.suffix?i:null,n]),a.appendTo(p)}),p.data("operations",c.operations),i.append([l,p]),a.append([s,i]),e?(e.append(a),t.initListeners(e)):(t.initListeners($("body")),selectEx=a)}setOption(e){this.selectPlaceHolder=e.selectPlaceHolder||this.selectPlaceHolder,this.searchPlaceHolder=e.searchPlaceHolder||this.searchPlaceHolder,this.selectId=e.selectId||(new Date).getTime()+"",this.width=e.width||this.width,this.css=e.css||this.css,this.onselected=e.onselected||null,this.inDuration=0==e.animate?0:this.inDuration,this.outDuration=0==e.animate?0:this.outDuration}static showBy(e,t){e.find(".search-box").val("");var a=e.find(".options"),s=t.attr("selectValue");e.css({width:t.outerWidth()+"px",left:t.offset().left-t.offsetParent().offset().left+"px",top:t.offset().top-t.offsetParent().offset().top+t.outerHeight()+"px",display:"block"});let i=30*e.find(".dropdown-item").length+2;e=$(window).height()-t.offset().top-t.height()-24+$(document).scrollTop()-8;i=i>e?e:i,a.css({height:i+"px"});var l=a.find(".dropdown-item");l.css({display:"flex"}),a.find(".selected").removeClass("selected");for(var n=0;n<l.length;n++)if(s==$(l[n]).attr("value")){$(l[n]).addClass("selected"),a.scrollTop(30*(n-1));break}a.animate({marginTop:0},t.data("inDuration"),"linear",()=>{}),LxySelect.setFlagOpen(t.attr("id"))}static hide(t){const a=$(".select-dropdown").not(":hidden");if(0<a.length)for(let e=a.length-1;0<=e;e--){const s=a.eq(e);0!=e?s.find(".options").animate({marginTop:"-100%"},$("#"+s.attr("for")).data("outDuration"),"linear",()=>{s.hide()}):s.find(".options").animate({marginTop:"-100%"},$("#"+s.attr("for")).data("outDuration"),"linear",(e=>()=>{e.hide(),LxySelect.setFlagAllClose(),t&&t()})(s))}else t&&t()}static setFlagOpen(e){const t=$("#"+e);t.parent().removeClass("closed"),t.parent().addClass("opend")}static setFlagAllClose(){const e=$(".lxy-select");e.parent().removeClass("opend"),e.parent().addClass("closed")}initListeners(e){e.attr("inited")||(e.on("click",".lxy-select-area",function(e){if($(e.target).hasClass("select-dropdown")||0<$(e.target).parents(".select-dropdown").length)return!0;const t=$(e.target).hasClass("lxy-select-area")?$(e.target):$(e.target).parents(".lxy-select-area"),a=t.find(".lxy-select");return console.log(t.find(".select-dropdown").is(":hidden")),t.find(".select-dropdown").is(":hidden")?LxySelect.hide(()=>{LxySelect.showBy(t.find(".select-dropdown"),a)}):LxySelect.hide(),!1}),$(document).on("click",function(e){0<$(e.target).parents(".select-dropdown").length||LxySelect.hide()}),$(document).on("keydown",e=>{"Escape"==e.key&&(0<$(e.target).parents(".select-dropdown").length||LxySelect.hide())}),e.on("keyup",".search-box",function(){var e=$(this),t=$("#"+e.parent().attr("for")),a=e.parent().find(".dropdown-item"),s=e.val().trim(),i=t.attr("selectValue"),l=t.parent().find(".options");if(""==s){a.css({display:"flex"});for(let e=0;e<a.length;e++)if(i==$(a[e]).attr("value")){$(a[e]).addClass("selected"),l.scrollTop(30*(e-1));break}}else for(let e=0;e<a.length;e++)$(a[e]).css({display:0<=$(a[e]).find(".item-text").text().indexOf(s)?"flex":"none"})}),e.on("click",".operation-button",function(){var e=$(this),t=e.parent().parent(),a=t.find(".item-text"),e=e.data("listener");return null==e||e({text:a.text(),value:t.attr("value")},t.parent().parent().find(".lxy-select").attr("id"))}),e.attr("inited","true"));var l=this;e.find(".select-dropdown").on("click",".item-text,.item-prefix",function(e){var t=$(this).parents(".dropdown-item"),a=t.parents(".select-dropdown"),s=a.attr("for"),i=$("#"+s),s=t.find(".item-prefix").text()+t.find(".item-text").text();i.val(""==s?" ":s),i.attr("selectValue",t.attr("value")),a.find(".selected").removeClass("selected"),t.addClass("selected"),l.onselected&&l.onselected({text:t.find(".item-text").text(),value:i.attr("selectValue"),prefix:t.find(".item-prefix").html()}),LxySelect.hide()})}static deleteOptions(e,t){for(var a=$("#"+e),s=$('[for="'+e+'"]').find(".dropdown-item"),i=s.length-1;0<=i;i--){var l=$(s[i]);0<=t.indexOf(l.attr("value"))&&(console.log("删除： "+l.attr("value")),l.remove(),l.hasClass("selected")&&(a.val(""),a.attr("selectValue","")))}}static setValue(e,t){console.log("设置： "+t);for(var a=$("#"+e),s=$('[for="'+e+'"]'),i=s.find(".options"),l=s.find(".dropdown-item"),n=0;n<l.length;n++){var o=$(l[n]);if(t==o.attr("value")){a.val(o.find(".item-prefix").text()+o.find(".item-text").text()),a.attr("selectValue",o.attr("value")),$(".select-dropdown").is(":hidden")||i.scrollTop(30*(n-1)),s.find(".selected").removeClass("selected"),o.addClass("selected");break}}}static getValue(e){return $("#"+e).attr("selectValue")}static getOptions(e){var a=[];return $('[for="'+e+'"] .dropdown-item').each((e,t)=>{t=$(t);a.push({text:t.attr("value"),value:t.find(".item-text").text(),prefix:t.find(".item-prefix").html()})}),a}static getSelectedOption(e){const t=$('[for="'+e+'"] .dropdown-item.selected');return 0<t.length?{text:t.attr("value"),value:t.find(".item-text").text(),prefix:t.find(".item-prefix").html()}:{}}static selectNext(e){var t=$('[for="'+e+'"] .dropdown-item.selected').attr("index");++t>=$('[for="'+e+'"] .dropdown-item').length&&(t=0),console.log("设置为第 "+t+" 个"),this.setValue(e,$('[for="'+e+'"] .dropdown-item[index="'+t+'"]').attr("value"))}static getText(e){return $('[for="'+e+'"] .dropdown-item.selected .item-text').text()}static addOption(e,t){var a=$('[for="'+e+'"] .options'),s=$('<div class="dropdown-item" value="'+t.value+'"></div>'),i=$('<div class="item-prefix"></div>'),e=$('<div class="item-text">'+t.text+"</div>"),l=$('<div class="item-operation"></div>');i.append(t.prefix);var n=a.data("operations");if(n)for(var o=0;o<n.length;o++){var r=n[o],d=$('<button class="operation-button operation-button-'+o+'">'+r.text+"</button>");d.data("listener",r.listener),r.class&&d.addClass(r.class),l.append(d)}s.attr("index",a.find(".dropdown-item").length),t.attr&&t.attr.forEach(e=>{s.attr(e.key,e.value)}),s.append([t.prefix?i:null,e,l]),s.appendTo(a)}}