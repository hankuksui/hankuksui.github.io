const imgMaxSize=100;$(function(){function t(){var o=$("#categoryUrlTree");o.empty(),DAO.db.exeSql("SELECT a.id,a.name,a.desc,null img,b.num,'1' type FROM categories a left join   (    select sup_id,count(1) num     from       (         select sup_id,1 num from categories where level = 2         union all         select cat_id,1 from urls      )     group by sup_id  ) b on a.id = b.sup_id WHERE a.level = 1 union all select c.id, c.name,c.addr desc,d. base_data img,0,'0' type from urls c left join icons d on c.img = d.id where c.cat_id = ''",[],a=>{console.log(a),a.forEach((e,t)=>{d(e,1,o,!1,a.length,t)})})}function e(){$("#caseSence").prop("checked")||!$("#hasChar").prop("checked")?($("#lowercase").prop("disabled",!0),$("#lowercase").next().addClass("disabled")):($("#lowercase").prop("disabled",!1),$("#lowercase").next().removeClass("disabled"))}function a(e,t,a){var o=$("<table></table>");o.css({width:"100%"});a=Form.generateForm([{label:InfoStr.categoryName,attr:{type:"text",id:"input-category-name"}},{label:InfoStr.catgoryDesc,attr:{type:"text",id:"input-category-description"}},{label:InfoStr.superCategory,attr:{type:"button",id:"button-super-category-select",value:e}},{label:InfoStr.superCategoryId,attr:{type:"hidden",id:"input-super-category-id",value:t}},{label:InfoStr.superCategoryLevel,attr:{type:"hidden",id:"input-super-category-level",value:a}}]);o.append(a),PopWin.show(InfoStr.newCategory,o,[new PopBtn(InfoStr.cancel,null,()=>{}),new PopBtn(InfoStr.add,LEVEL.SUCCESS,()=>{var a=$("#input-category-name").val(),o=$("#input-category-description").val(),r=$("#input-super-category-id").val();let n=$("#input-super-category-level").val();return n=""==n||""==r?"0":n,n=parseInt(n)+1,DAO.db.exeSql("SELECT 1 FROM categories WHERE name = ? and sup_id = ?",[a,r],e=>{var t;console.log(e),null==e||e.length<=0?(t={id:Math.uuidFast(),name:a,desc:o,sup_id:r,level:n,add_time:(new Date).getTime()},DAO.db.batInsert([t],"categories",()=>{Toast.show(formatString(InfoStr.categoryAddSucc,a),LEVEL.SUCCESS),PopWin.hide();var e=""==r?$("#categoryUrlTree"):$("#cat_"+r);""!=r&&"opened"!=e.attr("status")||(t.type="1",d(t,n,e,!0)),s(e,!0)},()=>{Toast.show(InfoStr.categoryAddFail,LEVEL.ERROR),PopWin.hide()})):Toast.show(InfoStr.categoryAlreadyExist,LEVEL.ERROR)},()=>{Toast.show(InfoStr.categoryCheckFail,LEVEL.ERROR)}),!1})])}function d(e,t,a,o,r,n){var l,i=$("<div class='sub-categories'></div>"),s=$("<div class='obj-area'></div>"),d=$("<img class='identifier-img' />"),c=$("<a class='open-obj' href='javascript:;'></a>"),p=$("<div class='oper-area'></div>"),u=$("<button class='delete-category error'>"+InfoStr.delete+"</button>"),g=$("<button class='update-category'>"+InfoStr.modify+"</button>"),f="1"==e.type?"cat":"url";i.attr("id",f+"_"+e.id),i.attr("obj_type",f),i.attr("obj_id",e.id),i.attr("level",""+t),i.attr("status","closed"),i.data("index",n),i.data("count",r),"url"==f?(d.attr("src",e.img||"assets/url.png"),i.attr("url",e.desc),p.append([g,u])):(d.attr("src","assets/"+(0<e.num?"not_empty":"empty")+"_closed.png"),l=$("<button class='add-sub-category'>"+InfoStr.addSubCategory+"</button>"),r=$("<button class='add-url'>"+InfoStr.addUrl+"</button>"),p.append([g,l,r,u])),e.desc&&(d.attr("title",e.desc),c.attr("title",e.desc)),c.text(e.name),s.append(function(l,i,s,d){const c=[];for(let n=0;n<l;n++){let e=$("<div class='tree-tab'></div>"),t=$("<div class='tree-tab-left'></div>"),a=$("<div class='tree-tab-up'></div>"),o=$("<div class='tree-tab-right'></div>"),r=$("<div class='tree-tab-down'></div>");1==l||n,e.data("obj_id",s),e.data("index",i),e.data("level",d),e.append([t,a,r,o]),c.push(e)}return c}(t,n,e.id,t),[d,c,p]),i.append(s),"url"!=f&&o?i.insertAfter(a.find(".sub-categories[obj_type='cat']").last()):a.append(i),function(e){e.find(".sub-categories .show-line").removeClass("show-line");var t=parseInt(e.attr("level")),a=e.find(".sub-categories[level='"+(t+1)+"']");let o=E(e);for(var r=0;r<a.length;r++)for(var n=$(a.get(r)),l=n.find(".tree-tab"),i=0;i<l.length;i++){var s=$(l.get(i)),d=s.data("index"),c=s.data("level"),p=function(e){var t=null;e&&(0<e.prev().length?t=e.prev():(e=e.parent()).hasClass("sub-categories")&&(t=e));return t}(n);!p||(i!=c-1&&p.find(".obj-area:first-child").find(".tree-tab:nth-child("+i+")").find(".tree-tab-down").hasClass("show-line")||i==c-1&&(0!=t||0!=d))&&s.find(".tree-tab-up").addClass("show-line"),i+1==c&&s.find(".tree-tab-right").addClass("show-line");d=E(n);if(d)if(c!=parseInt(d.attr("level"))){let e=d.find(".obj-area:first-child"),t=e.find(".tree-tab:nth-child("+i+")");0<t.length&&t.find(".tree-tab-up").hasClass("show-line")&&s.find(".tree-tab-down").addClass("show-line")}else if(o&&i<c-1){let e=o.find(".obj-area:first-child"),t=e.find(".tree-tab:nth-child("+i+")");0<t.length&&t.find(".tree-tab-up").hasClass("show-line")&&s.find(".tree-tab-down").addClass("show-line")}else i==c-1&&s.find(".tree-tab-down").addClass("show-line")}}(a);const S=localStorage.getItem("opendCats")||"";0<=S.indexOf(e.id)&&c.trigger("click")}function E(e){var t=null;return e&&(0<e.next().length?t=e.next():(e=e.parent()).hasClass("sub-categories")&&(t=E(e))),t}function s(e,t){"categoryUrlTree"!=e.attr("id")&&(e=e.find("img").first(),t?e.attr("src").indexOf("not_empty")<0&&e.attr("src",e.attr("src").replace("empty","not_empty")):e.attr("src",e.attr("src").replace("not_","")))}function n(e,t,a){var o=$("<table class='url'></table>");o.css({width:"100%"});var r=$("<img id='img-url' src='' /><span id='icon_list_container'></span><input type='button' id='add-img' value='"+InfoStr.uploadNewIcon+"' /><span style='color: red;'>&nbsp;"+formatString(InfoStr.imgTooLarge,imgMaxSize)+"</span>"),a=Form.generateForm([{label:InfoStr.urlDesc,attr:{type:"text",id:"input-url-name"}},{label:InfoStr.url,attr:{type:"text",id:"input-url-addr",class:"url"}},{label:InfoStr.icon,attr:{type:"file",id:"input-file"},replaceEl:r},{label:InfoStr.belongToCategory,attr:{type:"button",id:"button-super-category-select",value:e}},{label:InfoStr.belongCategoryId,attr:{type:"hidden",id:"input-super-category-id",value:t}},{label:InfoStr.belongCategoryLevel,attr:{type:"hidden",id:"input-super-category-level",value:a}}]);o.append(a),PopWin.show(InfoStr.newUrl,o,[new PopBtn(InfoStr.cancel,null,()=>{}),new PopBtn(InfoStr.add,LEVEL.SUCCESS,()=>{var a=$("#input-url-name").val(),o=$("#input-url-addr").val(),r=$("#input-super-category-id").val(),n=$("#input-super-category-level").val(),l=LxySelect.getValue("icon_list");return DAO.db.exeSql("SELECT 1 FROM urls WHERE cat_id = ? AND name = ?",[r,a],e=>{var t;console.log(e),null==e||e.length<=0?(t={id:Math.uuidFast(),name:a,addr:o,img:l,cat_id:r,add_time:(new Date).getTime()},DAO.db.batInsert([t],"urls",()=>{var e;Toast.show(formatString(InfoStr.urlAddSucc,a),LEVEL.SUCCESS),t.type="0",t.desc=o,t.img=$("#img-url").attr("src"),PopWin.hide(),""==r?d(t,1,$("#categoryUrlTree")):("opened"==(e=$("#cat_"+r)).attr("status")&&d(t,parseInt(n)+1,e),s(e,!0))},()=>{Toast.show(InfoStr.urlAddFail,LEVEL.ERROR),PopWin.hide()})):Toast.show(InfoStr.urlAlreadyExist,LEVEL.ERROR)},(e,t)=>{console.error(t),Toast.show(InfoStr.urlCheckFail,LEVEL.ERROR)}),!1})],()=>{DAO.db.exeSql("SELECT id, base_data, desc FROM icons",[],e=>{const t=[];e.forEach(e=>{t.push({prefix:$("<img class='url-img' src='"+e.base_data+"' />"),text:e.desc,value:e.id})}),new LxySelect({selectId:"icon_list",data:t,onselected:e=>{console.log(e),$("#img-url").attr("src",$(e.prefix).attr("src"))}},$("#icon_list_container")),LxySelect.setValue("icon_list","1"),$("#img-url").attr("src",$(LxySelect.getSelectedOption("icon_list").prefix).attr("src"))},()=>{Toast.show(InfoStr.iconQueryFail,LEVEL.ERROR),PopWin.hide(1)})})}function c(e){let t=localStorage.getItem("opendCats")||"";0<=t.indexOf(e)&&localStorage.setItem("opendCats",t.replace(e+",",""))}function r(o,r){DAO.db.exeSql("SELECT 1 FROM icons WHERE base_data = ?",[o],e=>{var t,a;0<e.length?Toast.show(InfoStr.iconExists,LEVEL.ERROR):(t=()=>{var e=Math.uuidFast(),t=$("#input-icon-desc").val();return DAO.db.batInsert([{id:e,base_data:o,desc:t,add_time:(new Date).getTime()}],"icons",()=>{Toast.show(InfoStr.iconAddSucc,LEVEL.SUCCESS),PopWin.hide(1),r&&r(e,t)},()=>{Toast.show(InfoStr.iconAddFail,LEVEL.ERROR)}),!1},(a=$("<table></table>")).css({width:"100%"}),e=Form.generateForm([{label:InfoStr.icon,attr:{type:"text",id:"input-img-src"},replaceEl:$("<img class='url-img' src='"+o+"' />")},{label:InfoStr.desc,attr:{type:"text",id:"input-icon-desc"},enterFn:t}]),a.append(e),PopWin.show(InfoStr.iconDesc,a,[new PopBtn(InfoStr.cancel,null,()=>{}),new PopBtn(InfoStr.save,LEVEL.SUCCESS,t)],()=>{$("#input-icon-desc").trigger("focus")},!0))},()=>{Toast.show(InfoStr.iconValidateFail,LEVEL.ERROR)})}$("#categoryUrlTree").on("click",".open-obj,.identifier-img",e=>{var o=$(e.target).parent().parent(),e=o.attr("obj_type"),t=o.attr("obj_id");if("cat"==e){var a=o.attr("status"),r=o.find(".identifier-img").first();if("closed"==a){var n=parseInt(o.attr("level"))+1;DAO.db.exeSql("SELECT a.id,a.name,a.desc,null img,b.num,'1' type FROM categories a left join (   select sup_id,count(1) num   from      (       select sup_id,1 num from categories where level = ?       union all       select cat_id,1 from urls      )   group by sup_id ) b on a.id = b.sup_id WHERE a.level = ? and a.sup_id = ? union all select c.id, c.name,c.addr desc,d.base_data img,0,'0' type from urls c left join icons d on c.img = d.id where c.cat_id = ?",[n+1,n,t,t],a=>{console.log(a),a.forEach((e,t)=>{d(e,n,o,!1,a.length,t)}),o.attr("status","opened"),r.attr("src",r.attr("src").replace("closed","opened")),function(e){let t=localStorage.getItem("opendCats")||"";t.indexOf(e)<0&&(t+=e+",",localStorage.setItem("opendCats",t))}(t)})}else{const l=o.find(".sub-categories");console.log(l);for(let e=0;e<l.length;e++){const i=$(l.get(e));"opened"==i.attr("status")&&(console.log(i),c(i.attr("obj_id")))}o.find(".sub-categories").remove(),o.attr("status","closed"),r.attr("src",r.attr("src").replace("opened","closed")),c(t)}}else{a=o.attr("url");if(a.startsWith("file")&&!location.protocol.startsWith("file")){const s=$('<input id="input_temp" type="hidden" />');s.val(a),s.appendTo($("body")),document.execCommand("copy")}else window.open(a)}}),$("#categoryUrlTree").on("click",".delete-category",e=>{console.log(e.target);const t=$(e.target).parent().parent().parent();console.log(t);const o=t.parent();var r=t.attr("obj_type"),n=t.attr("obj_id"),l=t.find("a").first().text(),i="cat"==r?InfoStr.category:InfoStr.url;PopWin.show(InfoStr.delete+i,formatString(InfoStr.deleteDesc,[i,l]),[new PopBtn(InfoStr.cancel,null,()=>{}),new PopBtn(InfoStr.delete,LEVEL.ERROR,()=>{var t,a;"cat"==r?(console.log(l),a=1,(t=[]).push(n),function a(e,t,o){DAO.db.exeSql("SELECT id, name FROM categories WHERE sup_id = ?",[e],e=>{o(e),e&&0<e.length&&e.forEach((e,t)=>{console.log(e.name),a(e.id,e.name,o)})},()=>{Toast.show(InfoStr.category+" "+InfoStr.quota1+t+InfoStr.quota2+" "+InfoStr.query+InfoStr.fail,LEVEL.ERROR)})}(n,l,e=>{a--,e&&0<e.length&&(a+=e.length,e.forEach(e=>{t.push(e.id)})),0==a&&DAO.db.exeSql("DELETE FROM urls WHERE cat_id in ?",[t],()=>{DAO.db.exeSql("DELETE FROM categories WHERE id in ?",[t],()=>{Toast.show(formatString(InfoStr.deleteSucc,[i,l]),LEVEL.SUCCESS),$("#cat_"+n).remove(),s(o,0<o.find(".sub-categories").length)},()=>{Toast.show(formatString(InfoStr.deleteFail,[i,l]),LEVEL.ERROR)})},()=>{Toast.show(InfoStr.urlDelFailUnderCat,LEVEL.ERROR)})})):DAO.db.exeSql("DELETE FROM urls WHERE id = ?",[n],()=>{Toast.show(formatString(InfoStr.deleteSucc,[i,l]),LEVEL.SUCCESS),$("#url_"+n).remove(),s(o,0<o.find(".sub-categories").length)},()=>{Toast.show(formatString(InfoStr.deleteFail,[i,l]),LEVEL.ERROR)})})])}),$("#categoryUrlTree").on("click",".update-category",e=>{console.log(e.target);const n=$(e.target).parent().parent().parent();var e=n.attr("obj_type"),l=n.attr("obj_id");"cat"==e?DAO.db.exeSql("SELECT id,name,desc,sup_id,level FROM categories WHERE id = ?",[l],e=>{var o,t;console.log(e),e&&0<e.length&&(o=e[0],(t=$("<table></table>")).css({width:"100%"}),e=function(){let t="",a=n.parents(".sub-categories");for(let e=a.length-1;0<=e;e--)t+=$(a[e]).find("a").first().text(),0<e&&(t+=" >> ");return t}(),e=Form.generateForm([{label:InfoStr.categoryId,attr:{type:"hidden",id:"input-category-id",value:l}},{label:InfoStr.categoryName,attr:{type:"text",id:"input-category-name",value:o.name}},{label:InfoStr.catgoryDesc,attr:{type:"text",id:"input-category-description",value:o.desc}},{label:InfoStr.superCategory,attr:{type:"text",readOnly:"readOnly",value:""==e?InfoStr.topLevel:e}}]),t.append(e),PopWin.show(InfoStr.modifyCategory,t,[new PopBtn(InfoStr.cancel,null,()=>{}),new PopBtn(InfoStr.save,LEVEL.SUCCESS,()=>{var t=$("#input-category-name").val(),a=$("#input-category-description").val();return DAO.db.exeSql("SELECT 1 FROM categories WHERE name = ? and sup_id = ? and id != ?",[t,o.sup_id,l],e=>{console.log(e),null==e||e.length<=0?DAO.db.exeSql("UPDATE categories set name = ? , desc = ? WHERE id = ?",[t,a,l],()=>{Toast.show(InfoStr.categoryModifySucc,LEVEL.SUCCESS),$("#cat_"+l).find("a").first().text(t),$("#cat_"+l+" .obj-area:nth(0) img,#cat_"+l+" .obj-area:nth(0) a").attr("title",a),PopWin.hide()},()=>{Toast.show(InfoStr.categoryModifyFail,LEVEL.ERROR)}):Toast.show(InfoStr.categoryAlreadyExist,LEVEL.ERROR)},()=>{Toast.show(InfoStr.categoryCheckFail,LEVEL.ERROR)}),!1})]))},()=>{Toast.show(InfoStr.categoryGetFail,LEVEL.ERROR)}):DAO.db.exeSql("SELECT a.id,a.name,a.addr,a.img img_id,b.base_data img,a.cat_id FROM urls a left join icons b on a.img = b.id WHERE a.id = ?",[l],e=>{var r,t,a;console.log(e),e&&0<e.length&&(r=e[0],(t=$("<table class='url'></table>")).css({width:"100%"}),a=function(){let t="",a=n.parents(".sub-categories");for(let e=a.length-1;0<=e;e--)t+=$(a[e]).find("a").first().text(),0<e&&(t+=" >> ");return t}(),e=$("<img id='img-url' src='"+(r.img||url_img_str)+"' /><span id='icon_list_container'></span><input type='button' id='add-img' value='"+InfoStr.uploadNewIcon+"' /><span style='color: red;'>&nbsp;"+formatString(InfoStr.imgTooLarge,imgMaxSize)+"</span>"),a=Form.generateForm([{label:InfoStr.urlId,attr:{type:"hidden",id:"input-url-id",value:l}},{label:InfoStr.urlDesc,attr:{type:"text",id:"input-url-name",value:r.name}},{label:InfoStr.url,attr:{type:"text",id:"input-url-description",value:r.addr}},{label:InfoStr.icon,attr:{type:"file",id:"input-file"},replaceEl:e},{label:InfoStr.belongToCategory,attr:{type:"text",readOnly:"readOnly",value:""==a?InfoStr.topLevel:a}}]),t.append(a),PopWin.show(InfoStr.modifyUrl,t,[new PopBtn(InfoStr.cancel,null,()=>{}),new PopBtn(InfoStr.save,LEVEL.SUCCESS,()=>{var t=$("#input-url-name").val(),a=$("#input-url-description").val(),o=LxySelect.getValue("icon_list");return DAO.db.exeSql("SELECT 1 FROM urls WHERE cat_id = ? AND name = ? and id != ?",[r.cat_id,t,l],e=>{console.log(e),null==e||e.length<=0?DAO.db.exeSql("UPDATE urls set name = ?, addr = ?, img = ? WHERE id = ?",[t,a,o,l],()=>{Toast.show(InfoStr.urlModifySucc,LEVEL.SUCCESS),$("#url_"+l).find("a").first().text(t),$("#url_"+l).find("img").attr("src",$("#img-url").attr("src")),PopWin.hide(),$("#url_"+l+" img,#url_"+l+" a").attr("url",a)},()=>{Toast.show(InfoStr.urlModifyFail,LEVEL.ERROR)}):Toast.show(InfoStr.urlAlreadyExist,LEVEL.ERROR)},(e,t)=>{console.error(t),Toast.show(InfoStr.urlAlreadyExist,LEVEL.ERROR)}),!1})],()=>{DAO.db.exeSql("SELECT id, base_data, desc FROM icons",[],e=>{const t=[];e.forEach(e=>{t.push({prefix:$("<img class='url-img' src='"+e.base_data+"' />"),text:e.desc,value:e.id})}),new LxySelect({selectId:"icon_list",data:t,onselected:e=>{console.log(e),$("#img-url").attr("src",$(e.prefix).attr("src"))}},$("#icon_list_container")),LxySelect.setValue("icon_list",r.img_id)},()=>{Toast.show(InfoStr.iconQueryFail,LEVEL.ERROR),PopWin.hide(1)})}))},()=>{Toast.show(InfoStr.urlGetFail,LEVEL.ERROR)})}),$("#categoriesList").on("click",".delete-category",e=>{console.log(e.target);const t=$(e.target);var a=t.attr("cat_id"),o=$("#cat_"+a).find(".category-name").text();PopWin.show("删除类别","您确认要删除类别 “"+o+"” 吗？",[new PopBtn("取消",null,()=>{}),new PopBtn("删除",LEVEL.ERROR,()=>{DAO.db.exeSql("DELETE FROM categories WHERE id = ?",[a],()=>{var c;Toast.show("类别 “"+o+"” 删除成功",LEVEL.SUCCESS),(c=$("#categoriesList")).empty(),DAO.db.exeSql("SELECT a.id,a.name,a.desc,a.sup_id,a.add_time,b.name sup_name FROM categories a LEFT JOIN categories b ON a.sup_id = b.id",[],e=>{console.log(e),e.forEach((e,t)=>{var a=$("<tr></tr>"),o=$("<td class='center'></td>"),r=$("<td class='category-name'></td>"),n=$("<td></td>"),l=$("<td></td>"),i=$("<td class='center'></td>"),s=$("<td class='center'></td>"),d=$("<button class='delete-category error'>"+InfoStr.delete+"</button>");a.attr("id","cat_"+e.id),o.text(t+1),r.text(e.name),n.text(e.desc),l.text(e.sup_name),i.text(new Date(e.add_time).format("yyyy-MM-dd hh:mm:ss")),d.attr("cat_id",e.id),s.append(d),a.append([o,r,n,l,i,s]),c.append(a)})})},()=>{Toast.show("类别 “"+o+"” 删除失败",LEVEL.ERROR)})})])}),$("#hasChar").on("change",()=>{$("#hasChar").prop("checked")?($("#caseSence").prop("disabled",!1),$("#caseSence").next().removeClass("disabled")):($("#caseSence").prop("disabled",!0),$("#caseSence").next().addClass("disabled")),e()}),$("#caseSence").on("change",e),$("#caseSence").on("change",e),$("#generatePassword").on("click",()=>{var e=parseInt($("#passwordLength").val()),t=$("#hasNum").prop("checked"),a=$("#hasChar").prop("checked"),o=$("#hasSymbol").prop("checked"),r=$("#caseSence").prop("checked"),n=$("#lowercase").prop("checked"),l=$("#blankSpace").prop("checked"),i=genEnCode(e,t,a,o,r,n,!l);if(null!=i){$("#password").val(i);const s=$('<input id="input_tmp" type="hidden" />');s.val(i),s.appendTo($("body")),document.execCommand("copy"),localStorage.setItem("hasNum",t?"1":"0"),localStorage.setItem("hasChar",a?"1":"0"),localStorage.setItem("hasSymbol",o?"1":"0"),localStorage.setItem("caseSence",r?"1":"0"),localStorage.setItem("lowercase",n?"1":"0"),localStorage.setItem("blankSpace",l?"1":"0"),localStorage.setItem("passwordLength",e)}else Toast.show(InfoStr.passwordConfigError,LEVEL.ERROR)}),$("#openAddCategoryWindow").on("click",()=>{a(InfoStr.selectSuperCategory,"","")}),$("body").on("click","#button-super-category-select",()=>{$(".menu-area").remove(),DAO.db.exeSql("SELECT a.id,a.name,a.desc,b.num FROM categories a left join (select sup_id,count(1) num from categories where level = 2 group by sup_id) b on a.id = b.sup_id WHERE a.level = 1",[],e=>{var t,r,a,o,n;console.log(e),null!=e&&0<e.length&&(t=$("#button-super-category-select"),(r=$("<div></div>")).addClass("menu-area level-1"),r.attr("level",1),a=$("<div></div>"),o=$("<div></div>"),n=$("<div></div>"),o.text(InfoStr.none),o.addClass("text"),n.text(""),n.addClass("right"),a.append([o,n]),a.addClass("menu"),a.attr("menu_id",""),a.attr("level",1),a.attr("path",InfoStr.none),r.append(a),e.forEach(e=>{var t=$("<div></div>"),a=$("<div></div>"),o=$("<div></div>");a.text(e.name),a.addClass("text"),o.text(e.num?">":""),o.addClass("right"),t.append([a,o]),t.addClass("menu"+(e.num?" has-next":"")),t.attr("menu_id",e.id),t.attr("level",1),t.attr("path",e.name),r.append(t)}),$("body").append(r),r.css({position:"absolute",top:t.offset().top+t.outerHeight()+"px",left:t.offset().left+"px"}))},()=>{Toast.show("查询类别失败",LEVEL.ERROR)})}),$("body").on("click",".menu",e=>{e=$(e.target);e.hasClass("menu")||(e=e.parent()),console.log(e[0]),$("#button-super-category-select").val(e.attr("path")),$("#input-super-category-id").val(e.attr("menu_id")),$("#input-super-category-level").val(e.attr("level"))}),$(document).on("click",e=>{"button-super-category-select"!=$(e.target).attr("id")&&$(".menu-area").remove()}),$("body").on("mouseenter",".menu",e=>{var a=$(e.target);a.hasClass("has-next")||(a=a.parent());var o,l=parseInt(a.attr("level"))+1;console.log(".level-"+l),$(".level-"+l).remove(),a.hasClass("has-next")&&(console.log(a[0]),o=a.attr("menu_id"),DAO.db.exeSql("SELECT a.id,a.name,a.desc,b.num FROM categories a left join (select sup_id,count(1) num from categories where level = ? group by sup_id) b on a.id = b.sup_id WHERE a.sup_id = ?",[l+1,o],e=>{var t,r,n;console.log(e),null!=e&&0<e.length&&(t=function(){for(var e="",t=1;t<=l;t++)e+=" level-"+t;return e}(),(r=$("<div></div>")).addClass("menu-area "+t),r.attr("for",o),r.attr("level",l),n=a.attr("path"),e.forEach(e=>{var t=$("<div></div>"),a=$("<div></div>"),o=$("<div></div>");a.text(e.name),a.addClass("text"),o.text(e.num?">":""),o.addClass("right"),t.append([a,o]),t.addClass("menu"+(e.num?" has-next":"")),t.attr("menu_id",e.id),t.attr("level",l),t.attr("path",n+(""==n?"":" >> ")+e.name),r.append(t)}),$("body").append(r),r.css({position:"absolute",top:a.offset().top+"px",left:a.offset().left+a.outerWidth()+"px"}))}))}),$("#categoryUrlTree").on("click",".add-sub-category",e=>{console.log(e.target);const o=$(e.target).parent().parent().parent();var t=o.attr("obj_id"),r=o.find("a").first().text(),e=o.attr("level");a(function(){let t="",a=o.parents(".sub-categories");for(let e=a.length-1;0<=e;e--)t+=$(a[e]).find("a").first().text(),0<e&&(t+=" >> ");return t+=(""==t?"":" >> ")+r,t}(),t,e)}),$("#categoryUrlTree").on("click",".add-url",e=>{console.log(e.target);const o=$(e.target).parent().parent().parent();console.log(o);var t=o.attr("obj_id"),r=o.find("a").first().text(),e=o.attr("level");n(function(){let t="",a=o.parents(".sub-categories");for(let e=a.length-1;0<=e;e--)t+=$(a[e]).find("a").first().text(),0<e&&(t+=" >> ");return t+=(""==t?"":" >> ")+r,t}(),t,e)}),$("body").on("click","#add-img",()=>{$("#input-file").trigger("click")}),$("body").on("click","#reset-img",()=>{$("#img-url").attr("src",url_img_str)}),$("#openAddUrlWindow").on("click",()=>{n(InfoStr.belongToCategory,"","")}),$("#openExportDataWindow").on("click",()=>{var e=$("<textarea id='sqlData'></textarea>");PopWin.show(InfoStr.ExportData,e,[new PopBtn(InfoStr.close,null,()=>{})],()=>{DAO.getAllData(e=>{$("#sqlData").val($("#sqlData").val()+e+";\n")})})}),$("#openImportDataWindow").on("click",()=>{var e=$("<table><tr style='color:red;'><td>"+InfoStr.importAttention+"</td></tr><tr><td><textarea id='sqlData' style='width: 100%;'></textarea></td></tr><tr><td><input type=\"button\" value=\""+InfoStr.chooseFile+'" id="btn_choose_file" /><input type="file" id="file_select" style="display: none;" /></td></tr></table>');PopWin.show(InfoStr.ImportData,e,[new PopBtn(InfoStr.cancel,null,()=>{}),new PopBtn(InfoStr.import,LEVEL.SUCCESS,()=>{const e=$("#sqlData").val();return DAO.db.batchExecute(["DELETE FROM categories","DELETE FROM urls","DELETE FROM icons"],()=>{DAO.db.batchExecute(e.split("\n"),()=>{Toast.show(InfoStr.importSucc,LEVEL.SUCCESS),PopWin.hide(),t()},()=>{Toast.show(InfoStr.importFail,LEVEL.ERROR)})},()=>{Toast.show(InfoStr.importCleanFail,LEVEL.ERROR)}),!1})],()=>{$("#btn_choose_file").on("click",()=>{$("#file_select").trigger("click")}),$("#file_select").on("change",e=>{console.log(e);var t=$(e.target).get(0).files;t&&0<t.length&&(e=t[0],window.FileReader&&((t=new FileReader).onloadend=function(e){e.target.readyState==FileReader.DONE&&(e=e.target.result,$("#sqlData").val(e))},t.readAsText(e)))})})}),$("body").on("change","#input-file",o=>{if(0<o.target.files.length){var e=o.target.files[0];console.log(e);const t=new FileReader;t.onload=function(e){const a=new Image;a.onload=function(){var e=this.width,t=this.height;e>imgMaxSize||t>imgMaxSize?Toast.show(formatString(InfoStr.imgTooLarge,imgMaxSize),LEVEL.ERROR):r(a.src,(e,t)=>{LxySelect.addOption("icon_list",{prefix:$("<img class='url-img' src='"+a.src+"' />"),text:t,value:e})}),$(o.target).val("")},a.onerror=e=>{console.log(e)},a.src=e.target.result},t.onerror=e=>{console.log(e)},t.onabort=()=>{},t.onloadstart=()=>{},t.onprogress=()=>{},t.readAsDataURL(e)}}),function(){for(var e=$("[infoStr]"),t=0;t<e.length;t++){var a=$(e.get(t));a.text(InfoStr[a.attr("infoStr")]),a.val(InfoStr[a.attr("infoStr")])}}(),$("#passwordLength").val(localStorage.getItem("passwordLength")||16),$("#hasNum").prop("checked","1"==localStorage.getItem("hasNum")),$("#hasChar").prop("checked","1"==localStorage.getItem("hasChar")),$("#hasSymbol").prop("checked","1"==localStorage.getItem("hasSymbol")),$("#caseSence").prop("checked","1"==localStorage.getItem("caseSence")),$("#lowercase").prop("checked","1"==localStorage.getItem("lowercase")),$("#blankSpace").prop("checked","1"==localStorage.getItem("blankSpace")),$("#hasChar").prop("checked")?($("#caseSence").prop("disabled",!1),$("#caseSence").next().removeClass("disabled"),$("#caseSence").prop("checked")?($("#lowercase").prop("disabled",!0),$("#lowercase").next().addClass("disabled")):($("#lowercase").prop("disabled",!1),$("#lowercase").next().removeClass("disabled"))):($("#caseSence").prop("disabled",!0),$("#caseSence").next().addClass("disabled"),$("#lowercase").prop("disabled",!0),$("#lowercase").next().addClass("disabled")),DAO.init(),t(),$("body").on("copy",e=>{0<$("#input_temp").length&&(e.preventDefault(),e.originalEvent&&e.originalEvent.clipboardData?(e.originalEvent.clipboardData.setData("text/plain",$("#input_temp").val()),Toast.show(InfoStr.urlCopied)):PopWin.show(InfoStr.url,$("#input_temp").val(),[new PopBtn(InfoStr.close)]),$("#input_temp").remove()),0<$("#input_tmp").length&&(e.preventDefault(),e.originalEvent&&e.originalEvent.clipboardData?(e.originalEvent.clipboardData.setData("text/plain",$("#input_tmp").val()),Toast.show(InfoStr.passwordCopied)):(console.log(InfoStr.pass+$("#input_tmp").val()),Toast.show(InfoStr.passwordPrinted)),$("#input_tmp").remove())}),$("#openIconWindow").on("click",()=>{const a=$('<table><tr><td><select id=\'icon_list\'></select></td></tr><tr><td><input type="file" id="input_icon_add" class="hidden" /></td></tr><tr><td><input type="button" value="'+InfoStr.add+'" id="btn_add_icon" /><input type="button" value="'+InfoStr.delete+'" id="btn_del_icon" /></td></tr></table>');PopWin.show(InfoStr.iconManagement,a,[new PopBtn(InfoStr.close,null,()=>{})],()=>{DAO.db.exeSql("select id, base_data, desc, sort_key from icons",[],e=>{const t=[];e.forEach(e=>{t.push({value:e.id,html:"<img class='url-img' src=\""+e.base_data+'" /> '+e.desc,text:e.desc})});e=new ListBox("icon_list",{options:t});$("#icon_list").data("icon_list",e),a.find(".list").css({maxHeight:.8*$(window).height()-80-20-10+"px"})})})}),$("body").on("click","#btn_add_icon",()=>{$("#input_icon_add").trigger("click")}),$("body").on("change","#input_icon_add",a=>{if(0<a.target.files.length){var e=a.target.files[0];const t=new FileReader;t.onload=function(e){const o=new Image;o.onload=function(){var e=this.width,t=this.height;e>imgMaxSize||t>imgMaxSize?Toast.show(formatString(InfoStr.imgTooLarge,imgMaxSize),LEVEL.ERROR):r(o.src,(e,t)=>{const a=$("#icon_list").data("icon_list");a.addOption({value:e,text:t,html:"<img class='url-img' src=\""+o.src+'" /> '+t})}),$(a.target).val("")},o.onerror=e=>{console.log(e)},o.src=e.target.result},t.onerror=e=>{console.log(e)},t.onabort=()=>{},t.onloadstart=()=>{},t.onprogress=()=>{},t.readAsDataURL(e)}}),$("body").on("click","#btn_del_icon",()=>{const a=$("#icon_list").data("icon_list");var o=a.getSelectedOption();"1"==o.value?Toast.show(InfoStr.iconCannotDeleteDefault,LEVEL.ERROR):DAO.db.exeSql("SELECT COUNT(1) num FROM urls where img = ?",[o.value],e=>{let t="";null!=e&&0<e.length&&0<e[0].num&&(t=formatString(InfoStr.iconUsedDesc,e[0].num)),PopWin.show(InfoStr.delete+InfoStr.icon,t+InfoStr.iconDeleteClP1+o.html+InfoStr.iconDeleteClP2,[new PopBtn(InfoStr.cancel,null,()=>{}),new PopBtn(InfoStr.confirm,LEVEL.ERROR,()=>{DAO.db.exeSql("DELETE FROM icons WHERE id = ?",[o.value],()=>{Toast.show(InfoStr.icon+" "+o.html+InfoStr.iconDelSuccP2,LEVEL.SUCCESS),a.deleteSelected()},()=>{Toast.show(InfoStr.iconDelFailP1+o.html+InfoStr.iconDelFailP2,LEVEL.ERROR)})})],null,!0)},()=>{})})});