const dbVersionName="UrlsDBVersion",dbVersionCode="UrlsDBVersionCode",versionCodeRel={"1.0.0":0,"1.0.1":1,"1.0.2":2};var DAO={db:null,dbversion:localStorage.getItem(dbVersionName)||"1.0.0",dbCode:localStorage.getItem(dbVersionCode)||versionCodeRel[localStorage.getItem(dbVersionName)||"1.0.0"],dbBuilds:[e=>{var d=versionCodeRel["1.0.1"];DAO.dbCode<d?DAO.db.batchExecute(["CREATE TABLE IF NOT EXISTS categories (id TEXT,name TEXT,desc TEXT,sup_id TEXT, level NUMBER, add_time NUMBER, CONSTRAINT pk_1 PRIMARY KEY (id))","CREATE TABLE IF NOT EXISTS urls (id TEXT,addr TEXT,name TEXT,img TEXT,cat_id TEXT,add_time NUMBER, CONSTRAINT pk_1 PRIMARY KEY (id))"],e,DAO.failFnSample):e()},e=>{var d="1.0.1",a=versionCodeRel[d];DAO.dbCode<a?DAO.db.db.changeVersion(DAO.dbversion,d,()=>{DAO.db.batchExecute(["ALTER TABLE categories ADD COLUMN sort_key NUMBER","ALTER TABLE urls ADD COLUMN sort_key NUMBER","CREATE TABLE IF NOT EXISTS icons (id TEXT, base_data TEXT, desc TEXT, sort_key NUMBER, add_time NUMBER, CONSTRAINT pk_1 PRIMARY KEY (id))"],()=>{},e=>{e(e)})},e=>{e(e)},()=>{DAO.dbversion=d,DAO.dbCode=a,localStorage.setItem(dbVersionName,DAO.dbversion),localStorage.setItem(dbVersionCode,DAO.dbCode),e()}):e()},e=>{localStorage.setItem(dbVersionCode,DAO.dbCode);var d="1.0.2",a=versionCodeRel[d];DAO.dbCode<a?DAO.db.db.changeVersion(DAO.dbversion,d,()=>{DAO.db.batchExecute(["ALTER TABLE icons ADD COLUMN img_type NUMBER","UPDATE icons set img_type = 1"],()=>{},e=>{e(e)})},e=>{e(e)},()=>{DAO.dbversion=d,DAO.dbCode=a,localStorage.setItem(dbVersionName,DAO.dbversion),localStorage.setItem(dbVersionCode,DAO.dbCode),e()}):e()}],buildDb:e=>{DAO.dbBuilds[e]&&DAO.dbBuilds[e](()=>{e++,DAO.buildDb(e)})},init:function(e){this.db=new Sqlite3("UrlsDB",DAO.dbversion),e&&"function"==typeof e&&(this.successFnSample=e),DAO.dbBuilds.push(()=>{DAO.db.batInsert([{id:"1",base_data:url_img_str,desc:InfoStr.default,img_type:1}],"icons",DAO.successFnSample,DAO.failFnSample)}),DAO.buildDb(0)},successFnSample:function(){},failFnSample:function(e,d){d(d)},getEveryData(d){this.db.getData("categories",e=>{null!=e&&0<e.length&&e.forEach(e=>{d("INSERT INTO categories(id,name,desc,sup_id,level,add_time,sort_key) values('"+e.id+"','"+e.name+"','"+e.desc+"','"+e.sup_id+"',"+e.level+","+e.add_time+","+e.sort_key+")")}),this.db.getData("urls",e=>{log(e),null!=e&&0<e.length&&e.forEach(e=>{d("INSERT INTO urls(id,addr,name,img,cat_id,add_time,sort_key) values('"+e.id+"','"+e.addr+"','"+e.name+"',"+(e.img?"'"+e.img+"'":"null")+",'"+e.cat_id+"',"+e.add_time+","+e.sort_key+")")}),this.db.getData("icons",e=>{log(e),null!=e&&0<e.length&&e.forEach(e=>{d("INSERT INTO icons(id,img_type,base_data,desc,sort_key,add_time) values('"+e.id+"',"+e.img_type+",'"+e.base_data+"','"+e.desc+"',"+e.sort_key+","+e.add_time+")")})},()=>{})},()=>{})},()=>{})},getAllData(d){let a="";this.db.getData("categories",e=>{null!=e&&0<e.length&&e.forEach(e=>{a+="INSERT INTO categories(id,name,desc,sup_id,level,add_time,sort_key) values('"+e.id+"','"+e.name+"','"+e.desc+"','"+e.sup_id+"',"+e.level+","+e.add_time+","+e.sort_key+");\n"}),this.db.getData("urls",e=>{log(e),null!=e&&0<e.length&&e.forEach(e=>{a+="INSERT INTO urls(id,addr,name,img,cat_id,add_time,sort_key) values('"+e.id+"','"+e.addr+"','"+e.name+"',"+(e.img?"'"+e.img+"'":"null")+",'"+e.cat_id+"',"+e.add_time+","+e.sort_key+");\n"}),this.db.getData("icons",e=>{log(e),null!=e&&0<e.length&&e.forEach(e=>{a+="INSERT INTO icons(id,img_type,base_data,desc,sort_key,add_time) values('"+e.id+"',"+e.img_type+",'"+e.base_data+"','"+e.desc+"',"+e.sort_key+","+e.add_time+");\n"}),d(a)},()=>{})},()=>{})},()=>{})},Category:{id:"",name:"",sup_id:"",level:0,add_time:0},Url:{id:"",addr:"",name:"",img:"",cat_id:"",add_time:0}};