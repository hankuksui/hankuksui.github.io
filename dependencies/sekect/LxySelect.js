class LxySelect{constructor(n,e){this.selectPlaceHolder=InfoStr.selectPlaceHolder,this.selectId="",this.searchPlaceHolder=InfoStr.searchPlaceHolder,this.width="120px",this.css={},this.selectEx=[];var t=this;t.setOption(n);var s=$('<input readonly="readonly" placeHolder="'+t.selectPlaceHolder+'" id="'+t.selectId+'" class="lxy-select" />'),i=$('<div for="'+t.selectId+'" class="select-dropdown"></div>'),a=$('<input placeholder="'+t.searchPlaceHolder+'" class="search-box" />'),c=$('<div class="options"></div>');s.width(t.width),s.css(t.css),n.data&&n.data.forEach((e,t)=>{var s=$('<div class="dropdown-item" value="'+e.value+'"></div>'),i=$('<div class="item-prefix"></div>'),a=$('<div class="item-text">'+e.text+"</div>"),l=$('<div class="item-operation"></div>');if(i.append(e.prefix),n.operations)for(var d=0;d<n.operations.length;d++){var o=n.operations[d],r=$('<button class="operation-button operation-button-'+d+'">'+o.text+"</button>");r.data("listener",o.listener),o.class&&r.addClass(o.class),l.append(r)}s.attr("index",t),e.attr&&e.attr.forEach(e=>{s.attr(e.key,e.value)}),s.append([e.prefix?i:null,a,l]),s.appendTo(c)}),c.data("operations",n.operations),i.append([a,c]),e?(e.append([s,i]),t.initListeners(e)):(t.initListeners($("body")),selectEx=[s,i])}setOption(e){this.selectPlaceHolder=e.selectPlaceHolder||this.selectPlaceHolder,this.searchPlaceHolder=e.searchPlaceHolder||this.searchPlaceHolder,this.selectId=e.selectId||(new Date).getTime()+"",this.width=e.width||this.width,this.css=e.css||this.css,this.onselected=e.onselected||null}static showBy(e,t){e.find(".search-box").val("");var s=e.find(".options"),i=t.attr("selectValue");e.css({width:t.outerWidth()+"px",left:t.offset().left-t.offsetParent().offset().left+"px",top:t.offset().top-t.offsetParent().offset().top+t.outerHeight()+"px",display:"block"});let a=30*e.find(".dropdown-item").length+2;t=$(window).height()-t.offset().top-t.height()-24+$(document).scrollTop()-8;a=a>t?t:a,s.css({height:a+"px"});var l=s.find(".dropdown-item");l.css({display:"flex"}),s.find(".selected").removeClass("selected");for(var d=0;d<l.length;d++)if(i==$(l[d]).attr("value")){$(l[d]).addClass("selected"),s.scrollTop(30*(d-1));break}}initListeners(e){e.attr("inited")||(e.on("click",".lxy-select",function(){var e=$(this),t=e.parent();return console.log(t.find(".select-dropdown").is(":hidden")),t.find(".select-dropdown").is(":hidden")?($(".select-dropdown").hide(),LxySelect.showBy(t.find(".select-dropdown"),e)):$(".select-dropdown").hide(),!1}),$(document).on("click",function(e){0<$(e.target).parents(".select-dropdown").length||$(".select-dropdown").hide()}),$(document).on("keydown",e=>{"Escape"==e.key&&(0<$(e.target).parents(".select-dropdown").length||$(".select-dropdown").hide())}),e.on("keyup",".search-box",function(){var e=$(this),t=$("#"+e.parent().attr("for")),s=e.parent().find(".dropdown-item"),i=e.val().trim(),a=t.attr("selectValue"),l=t.parent().find(".options");if(""==i){s.css({display:"flex"});for(let e=0;e<s.length;e++)if(a==$(s[e]).attr("value")){$(s[e]).addClass("selected"),l.scrollTop(30*(e-1));break}}else for(let e=0;e<s.length;e++)$(s[e]).css({display:0<=$(s[e]).find(".item-text").text().indexOf(i)?"flex":"none"})}),e.on("click",".operation-button",function(){var e=$(this),t=e.parent().parent(),s=t.find(".item-text");return e.data("listener")({text:s.text(),value:t.attr("value")},t.parent().parent().find(".lxy-select").attr("id"))}),e.attr("inited","true"));var l=this;e.find(".select-dropdown").on("click",".item-text,.item-prefix",function(e){var t=$(this).parents(".dropdown-item"),s=t.parents(".select-dropdown"),i=s.attr("for"),a=$("#"+i),i=t.find(".item-prefix").text()+t.find(".item-text").text();a.val(""==i?" ":i),a.attr("selectValue",t.attr("value")),s.find(".selected").removeClass("selected"),t.addClass("selected"),l.onselected&&l.onselected({text:t.find(".item-text").text(),value:a.attr("selectValue"),prefix:t.find(".item-prefix").html()}),$(".select-dropdown").hide()})}static deleteOptions(e,t){for(var s=$("#"+e),i=$('[for="'+e+'"]').find(".dropdown-item"),a=i.length-1;0<=a;a--){var l=$(i[a]);0<=t.indexOf(l.attr("value"))&&(console.log("删除： "+l.attr("value")),l.remove(),l.hasClass("selected")&&(s.val(""),s.attr("selectValue","")))}}static setValue(e,t){console.log("设置： "+t);for(var s=$("#"+e),i=$('[for="'+e+'"]'),a=i.find(".options"),l=i.find(".dropdown-item"),d=0;d<l.length;d++){var o=$(l[d]);if(t==o.attr("value")){s.val(o.find(".item-prefix").text()+o.find(".item-text").text()),s.attr("selectValue",o.attr("value")),$(".select-dropdown").is(":hidden")||a.scrollTop(30*(d-1)),i.find(".selected").removeClass("selected"),o.addClass("selected");break}}}static getValue(e){return $("#"+e).attr("selectValue")}static getOptions(e){var s=[];return $('[for="'+e+'"] .dropdown-item').each((e,t)=>{t=$(t);s.push({text:t.attr("value"),value:t.find(".item-text").text(),prefix:t.find(".item-prefix").html()})}),s}static getSelectedOption(e){const t=$('[for="'+e+'"] .dropdown-item.selected');return 0<t.length?{text:t.attr("value"),value:t.find(".item-text").text(),prefix:t.find(".item-prefix").html()}:{}}static selectNext(e){var t=$('[for="'+e+'"] .dropdown-item.selected').attr("index");++t>=$('[for="'+e+'"] .dropdown-item').length&&(t=0),console.log("设置为第 "+t+" 个"),this.setValue(e,$('[for="'+e+'"] .dropdown-item[index="'+t+'"]').attr("value"))}static getText(e){return $('[for="'+e+'"] .dropdown-item.selected .item-text').text()}static addOption(e,t){var s=$('[for="'+e+'"] .options'),i=$('<div class="dropdown-item" value="'+t.value+'"></div>'),a=$('<div class="item-prefix"></div>'),e=$('<div class="item-text">'+t.text+"</div>"),l=$('<div class="item-operation"></div>');a.append(t.prefix);var d=s.data("operations");if(d)for(var o=0;o<d.length;o++){var r=d[o],n=$('<button class="operation-button operation-button-'+o+'">'+r.text+"</button>");n.data("listener",r.listener),r.class&&n.addClass(r.class),l.append(n)}i.attr("index",s.find(".dropdown-item").length),t.attr&&t.attr.forEach(e=>{i.attr(e.key,e.value)}),i.append([t.prefix?a:null,e,l]),i.appendTo(s)}}