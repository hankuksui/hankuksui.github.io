var Sqlite3=function(t,n){var d=openDatabase(t,n,"url&tools",10485760);return{getDBName:function(){return t},db:d,init:function(t,n){return this.switchTable(t),0<n.length&&this.createTable(n),this},createTable:function(t){var n="CREATE TABLE IF NOT EXISTS "+this._table;if(t instanceof Array&&0<t.length){for(var e=[],r=0;r<t.length;r++)e.push(t[r].name+" "+t[r].type);e=e.join(", ")}else"object"==typeof t&&(e+=t.name+" "+t.type);n=n+" ("+e+")";d.transaction(function(t){t.executeSql(n)})},switchTable:function(t){return this._table=t,this._where="",this},insertData:function(t,n,e,r){null==r&&(r=function(t,n){i.onfail(t,n)});var i=this,o="REPLACE INTO "+n;if(!(t instanceof Array&&0<t.length))return!1;var a,f=[],u=[];for(a in t[0])f.push(a),u.push("?");o+=" ("+f.join(",")+") Values ("+u.join(",")+")";var s=[],h=t,c=[];for(let t=0,n=h.length;t<n;t++){var l,v=[];for(l in h[t])v.push(h[t][l]);s.push(v)}var p=function(t,n){n&&c.push(n.insertId||n.rowsAffected),0<s.length?d.transaction(function(t){t.executeSql(o,s.shift(),p,function(t,n){r(t,n)})}):e&&e.call(this,c)};p()},_where:"",where:function(t){var n;return t?"object"==typeof t?(n=this.toArray(t),this._where=n.join(" and ")):"string"==typeof t&&(this._where=t):this._where="",this},updateData:function(t,n,e,r){r=r||this._where;n="Update "+n;n+=" Set "+(t=this.toArray(t).join(","))+" where "+r,this.doQuery(n,e)},saveData:function(n,e,r,i){var o=this;i=i||o._where;var t="select * from "+e+" where "+i;this.doQuery(t,function(t){0<t.length&&t[0]instanceof Object?o.updateData(n,e,r,i):o.insertData([n],e,r)})},getData:function(t,n,e){t="select * from "+t;0<this._where.length&&(t+=" where "+this._where),this.doQuery(t,n,e)},doQuery:function(n,r,e){null==e&&(e=function(t,n){o.onfail(t,n)});function i(t,n){if(n.rows.length)for(var e=0;e<n.rows.length;e++)a.push(n.rows.item(e));r&&r.call(o,a)}var o=this,a=[];d.transaction(function(t){t.executeSql(n,[],i,e)})},createIndex:function(t,n,e,r){var i="create index on "+n,o=e.length;0<o&&(i+="(");for(var a=0;a<o;a++)i+=e[a],a<o-1&&(i+=",");0<o&&(i+=")"),this.doQuery(i,r)},deleteData:function(t,n){t="delete from "+t;0<this._where.length&&(t+=" where "+this._where),this.doQuery(t,n)},dropTable:function(t,n,e){null==n&&(n=function(){}),null==e&&(e=function(){});t="DROP TABLE IF EXISTS "+t;this.doQuery(t,n,e)},_error:"",onfail:function(t,n){this._error=n.message},toArray:function(t){var n=[];if(t=t||{})for(var e in t)n.push(e+"='"+t[e]+"'");return n},exeSql:function(t,n,e,r){var i=t.split("?");t="";for(var o=0;o<i.length;o++)if(t+=i[o],null!=n[o]&&(n[o],1))if("string"==typeof n[o])t+=" '"+n[o]+"' ";else if(n[o]instanceof Array){t+=" (";for(var a=0;a<n[o].length;a++)"string"==typeof n[o][a]?t+="'"+n[o][a]+"'":t+=n[o][a],a<n[o].length-1&&(t+=",");t+=") "}else t+=" "+n[o]+" ";this.doQuery(t,e,r)},queryData:function(t,n,e,r){var i=this;i.where(t),i.getData(n,function(t,n){i.where(""),e(t,n)},function(t,n){i.where(""),r(t,n)})},batInsert:function(v,p,g,y){var w=this;null==y&&(y=function(t,n){w.onfail(t,n)}),d.transaction(function(t){var e=v.length,r=0;0==e&&g();function n(t,n){++r==e&&g(n)}function i(t,n){y(t,n)}for(var o=0;o<e;o++){for(var a=v[o],f=w.ShowObjProperty(a),u="",s=f.split(", "),h=s.length,c=[],l=0;l<h;l++)c[l]=a[s[l]],u+="?",l!=h-1&&(u+=",");t.executeSql("replace into "+p+"("+f+") values("+u+")",c,n,i)}})},batInsert2:function(v,p,g,y){var w=this;null==y&&(y=function(t,n){w.onfail(t,n)}),d.transaction(function(t){function n(t,n){++i==r&&g(n)}function e(t,n){y(t,n)}for(var r=v.length,i=0,o=0;o<r;o++){for(var a=v[o],f=w.ShowObjProperty(a),u="",s=f.split(", "),h=s.length,c=[],l=0;l<h;l++)c[l]=a[s[l]],u+="?",l!=h-1&&(u+=",");t.executeSql("insert into "+p+"("+f+") values("+u+")",c,n,e)}})},ShowObjProperty:function(t,n,e){var r,i="";for(r in t)null!=t[r]&&"function"!=typeof t[r]&&(i+=r+", ");return i.substr(0,i.length-2)},containes:function(t,n){return t.startsWith(t+" ")||t.startsWith(t+",")||0<=t.indexOf(" "+t+" ")||0<=t.indexOf(","+t+" ")||0<=t.indexOf(" "+t+",")||0<=t.indexOf(","+t+",")||t.endWith(","+t)||t.endWith(" "+t)},batchExecute:function(t,n,e){t&&("string"==typeof t||t instanceof Array)?("string"==typeof t&&(t=[t]),d.transaction(function(n){t.forEach(t=>{t&&""!=t.trim()&&n.executeSql(t,[])})},e,n)):e(null,"SQL错误")}}};